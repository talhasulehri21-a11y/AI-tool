
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OmniTools Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <link rel="preconnect" href="https://rsms.me/">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://aistudiocdn.com/@google/genai@^1.16.0",
        "react": "https://aistudiocdn.com/react@^19.1.1",
        "react-dom/client": "https://aistudiocdn.com/react-dom@^19.1.1/client"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useCallback, useRef, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';
        import { GoogleGenAI } from "@google/genai";

        // --- START OF adsConfig.ts ---
        const adsConfig = {
          topBanner: 'YOUR_TOP_BANNER_AD_UNIT_ID',
          bottomBanner: 'YOUR_BOTTOM_BANNER_AD_UNIT_ID',
          popup: 'YOUR_POPUP_AD_UNIT_ID',
        };
        // --- END OF adsConfig.ts ---

        // --- START OF services/geminiService.ts ---
        let ai = null;

        const initializeGemini = (apiKey) => {
          if (!apiKey) {
            ai = null;
            return;
          }
          ai = new GoogleGenAI({ apiKey });
        };

        const getAiClient = () => {
          if (!ai) {
            throw new Error("Gemini API key not set or invalid. Please set your key in the sidebar.");
          }
          return ai;
        };

        const reviewCode = async (code, language) => {
          const prompt = `
            As an expert senior software engineer, please perform a thorough code review of the following ${language} code.
            Provide feedback on the following aspects:
            1.  **Bugs and Errors**: Identify potential bugs, logic errors, and edge cases that might have been missed.
            2.  **Performance**: Suggest optimizations for performance bottlenecks.
            3.  **Clarity and Readability**: Comment on code style, naming conventions, and overall readability. Suggest improvements to make the code more maintainable.
            4.  **Best Practices**: Check if the code follows established best practices and design patterns for ${language}.
            5.  **Security**: Point out any potential security vulnerabilities.

            Provide your feedback in Markdown format. Use headings, lists, and code blocks for clarity. Start with a brief summary of your findings.

            Here is the code to review:
            \`\`\`${language}
            ${code}
            \`\`\`
            `;

          try {
            const aiClient = getAiClient();
            const response = await aiClient.models.generateContent({
                model: 'gemini-2.5-flash',
                contents: prompt
            });
            return response.text;
          } catch (error) {
            console.error("Error reviewing code with Gemini:", error);
            if (error instanceof Error) {
                throw new Error(`An error occurred during the code review: ${error.message}`);
            }
            throw new Error("An unknown error occurred during the code review.");
          }
        };


        const generateImage = async (prompt) => {
          try {
            const aiClient = getAiClient();
            const response = await aiClient.models.generateImages({
                model: 'imagen-4.0-generate-001',
                prompt: prompt,
                config: {
                  numberOfImages: 1,
                  outputMimeType: 'image/jpeg',
                  aspectRatio: '1:1',
                },
            });

            if (response.generatedImages && response.generatedImages.length > 0) {
                const base64ImageBytes = response.generatedImages[0].image.imageBytes;
                return `data:image/jpeg;base64,${base64ImageBytes}`;
            } else {
                throw new Error("No image was generated.");
            }
          } catch (error) {
            console.error("Error generating image with Gemini:", error);
            if (error instanceof Error) {
                throw new Error(`An error occurred during image generation: ${error.message}`);
            }
            throw new Error("An unknown error occurred during image generation.");
          }
        };

        const summarizeText = async (text) => {
          const prompt = `
            Please summarize the following text concisely. Capture the main points and key information.
            The summary should be easy to read and understand.

            Text to summarize:
            ---
            ${text}
            ---
          `;

          try {
            const aiClient = getAiClient();
            const response = await aiClient.models.generateContent({
              model: 'gemini-2.5-flash',
              contents: prompt,
            });
            return response.text;
          } catch (error) {
            console.error("Error summarizing text with Gemini:", error);
            if (error instanceof Error) {
              throw new Error(`An error occurred during text summarization: ${error.message}`);
            }
            throw new Error("An unknown error occurred during text summarization.");
          }
        };
        // --- END OF services/geminiService.ts ---

        // --- START OF ICON COMPONENTS ---
        const LogoIcon = (props) => (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
          </svg>
        );

        const CodeIcon = (props) => (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
            <polyline points="16 18 22 12 16 6"></polyline>
            <polyline points="8 6 2 12 8 18"></polyline>
          </svg>
        );

        const DocumentIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
        );
        
        const CalculatorIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
                <line x1="8" y1="6" x2="16" y2="6"></line>
                <line x1="12" y1="10" x2="12" y2="18"></line>
                <line x1="8" y1="14" x2="16" y2="14"></line>
            </svg>
        );
        
        const TextIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
        );

        const DeveloperIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <polyline points="16 18 22 12 16 6"></polyline>
                <polyline points="8 6 2 12 8 18"></polyline>
                <line x1="12" y1="4" x2="12" y2="20"></line>
            </svg>
        );
        
        const ToolsIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
            </svg>
        );
        
        const CompressIcon = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="9" y1="15" x2="15" y2="9"></line>
                <polyline points="12 9 15 9 15 12"></polyline>
                <polyline points="12 15 9 15 9 12"></polyline>
            </svg>
        );
        // --- END OF ICON COMPONENTS ---

        // --- START OF components/Ads.tsx ---
        const BannerAd = ({ slotId }) => {
          return (
            <div className="bg-slate-200 dark:bg-slate-700 text-center py-2 shrink-0">
              <p className="text-sm text-slate-500 dark:text-slate-400">Advertisement</p>
              <div className="text-xs text-slate-400 dark:text-slate-500">Slot ID: {slotId}</div>
            </div>
          );
        };

        const PopupAd = ({ slotId, isOpen, onClose }) => {
          if (!isOpen) {
            return null;
          }

          return (
            <div 
                className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
                aria-modal="true"
                role="dialog"
            >
              <div className="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-md relative">
                <button 
                    onClick={onClose} 
                    className="absolute top-2 right-2 text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-white"
                    aria-label="Close ad"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
                <div className="text-center">
                    <h2 className="text-lg font-semibold mb-4 text-slate-800 dark:text-white">Advertisement</h2>
                    <div className="bg-slate-200 dark:bg-slate-700 p-8 min-h-[250px] flex items-center justify-center rounded">
                        <div>
                            <p className="text-sm text-slate-500 dark:text-slate-400">Pop-up Ad Content</p>
                            <div className="text-xs text-slate-400 dark:text-slate-500 mt-1">Slot ID: {slotId}</div>
                        </div>
                    </div>
                </div>
              </div>
            </div>
          );
        };
        // --- END OF components/Ads.tsx ---
        
        // --- START OF components/ApiKeyPrompt.tsx ---
        const ApiKeyPrompt = () => {
          return (
            <div className="flex flex-col items-center justify-center h-full text-center">
              <div className="bg-yellow-50 dark:bg-yellow-900/50 border border-yellow-400 dark:border-yellow-600 rounded-lg p-8 max-w-lg">
                <svg className="w-16 h-16 text-yellow-500 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
                <h2 className="text-2xl font-bold text-slate-800 dark:text-white mb-2">API Key Required</h2>
                <p className="text-slate-600 dark:text-slate-400">
                  To use this tool, please enter your Gemini API Key in the settings panel in the sidebar.
                </p>
              </div>
            </div>
          );
        };
        // --- END OF components/ApiKeyPrompt.tsx ---
        
        // --- START OF components/ReviewOutput.tsx ---
        const Spinner = () => (
          <div className="flex flex-col items-center justify-center h-full text-center">
            <svg className="animate-spin -ml-1 mr-3 h-10 w-10 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p className="mt-4 text-slate-500 dark:text-slate-400">Gemini is reviewing your code...</p>
          </div>
        );

        const ReviewOutput = ({ review, isLoading, error }) => {
          const parseMarkdownToHTML = (text) => {
            let sanitized = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            const parts = sanitized.split(/(\`{3}[\s\S]*?\`{3})/g);

            const html = parts.map((part) => {
              if (part.startsWith("```")) {
                const langMatch = part.match(/^\`{3}(\w*)\n/);
                const language = langMatch ? langMatch[1] : '';
                const code = part.replace(/^\`{3}\w*\n/, '').replace(/\`{3}$/, '').trim();
                return `<pre class="bg-slate-200 dark:bg-slate-900 rounded-md p-4 text-sm overflow-x-auto my-4"><code class="language-${language}">${code}</code></pre>`;
              } else {
                let processedPart = part;
                processedPart = processedPart
                  .replace(/^### (.*$)/gim, '<h3 class="text-xl font-semibold mt-4 mb-2 dark:text-white">$1</h3>')
                  .replace(/^## (.*$)/gim, '<h2 class="text-2xl font-bold mt-6 mb-3 border-b pb-2 dark:text-white dark:border-slate-600">$1</h2>')
                  .replace(/^# (.*$)/gim, '<h1 class="text-3xl font-bold mt-8 mb-4 border-b-2 pb-2 dark:text-white dark:border-slate-500">$1</h1>');
                
                processedPart = processedPart
                  .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                  .replace(/\*(.*?)\*/g, '<em>$1</em>');
                    
                processedPart = processedPart.replace(/(?:^\s*[-*] .*(?:\n|$))+/gm, (match) => {
                    const listItems = match.trim().split('\n').map(line => 
                        `<li>${line.replace(/^\s*[-*]\s*/, '')}</li>`
                    ).join('');
                    return `<ul class="list-disc list-outside pl-6 space-y-1 my-4">${listItems}</ul>`;
                });
                    
                processedPart = processedPart.trim().split('\n\n').map(p => {
                    const trimmedParagraph = p.trim();
                    if (trimmedParagraph === '') return '';
                    if (trimmedParagraph.match(/^<(h[1-3]|ul|li|pre)/)) {
                        return trimmedParagraph;
                    }
                    return `<p>${trimmedParagraph.replace(/\n/g, '<br />')}</p>`;
                }).join('');

                return processedPart;
              }
            }).join('');

            return html;
          };

          if (isLoading) {
            return <Spinner />;
          }

          if (error) {
            return (
              <div className="flex items-center justify-center h-full text-center text-red-500">
                <div className="bg-red-100 dark:bg-red-900/50 border border-red-400 dark:border-red-600 rounded-md p-4">
                  <p className="font-semibold">An Error Occurred</p>
                  <p className="text-sm">{error}</p>
                </div>
              </div>
            );
          }

          if (!review) {
            return (
              <div className="flex items-center justify-center h-full text-center">
                <p className="text-slate-500 dark:text-slate-400">Your code review feedback will appear here.</p>
              </div>
            );
          }

          return (
            <div 
              className="prose prose-slate dark:prose-invert max-w-none" 
              dangerouslySetInnerHTML={{ __html: parseMarkdownToHTML(review) }} 
            />
          );
        };
        // --- END OF components/ReviewOutput.tsx ---

        // --- START OF components/CodeReviewer.tsx ---
        const CodeReviewer = () => {
          const languages = [
            "javascript", "python", "java", "csharp", "php", "cpp", "typescript", "go", "ruby", "swift", "kotlin", "rust", "sql", "html", "css"
          ];

          const [code, setCode] = useState('');
          const [language, setLanguage] = useState('javascript');
          const [review, setReview] = useState('');
          const [isLoading, setIsLoading] = useState(false);
          const [error, setError] = useState('');

          const handleReview = useCallback(async () => {
            if (!code.trim()) {
              setError('Please enter some code to review.');
              return;
            }
            setIsLoading(true);
            setError('');
            setReview('');
            try {
              const result = await reviewCode(code, language);
              setReview(result);
            } catch (err) {
              if (err instanceof Error) {
                setError(`Failed to get review: ${err.message}`);
              } else {
                setError('An unknown error occurred during the code review.');
              }
              console.error(err);
            } finally {
              setIsLoading(false);
            }
          }, [code, language]);

          return (
            <>
              <header className="mb-6">
                <h1 className="text-3xl font-bold text-slate-900 dark:text-white">AI Code Reviewer</h1>
                <p className="text-slate-500 dark:text-slate-400 mt-1">Get instant feedback on your code from Gemini.</p>
              </header>
              <div className="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-8 overflow-hidden">
                <div className="flex flex-col h-full">
                  <div className="mb-4">
                    <label htmlFor="language-select" className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                      Language
                    </label>
                    <select
                      id="language-select"
                      value={language}
                      onChange={(e) => setLanguage(e.target.value)}
                      className="w-full bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500"
                    >
                      {languages.map((lang) => (
                        <option key={lang} value={lang} className="capitalize">{lang}</option>
                      ))}
                    </select>
                  </div>
                  <div className="flex-1 flex flex-col">
                    <label htmlFor="code-input" className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                      Your Code
                    </label>
                    <textarea
                      id="code-input"
                      value={code}
                      onChange={(e) => setCode(e.target.value)}
                      placeholder="Paste your code here..."
                      className="flex-1 w-full p-3 font-mono text-sm bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-md resize-none focus:ring-indigo-500 focus:border-indigo-500"
                    />
                  </div>
                  <div className="mt-4">
                    <button
                      onClick={handleReview}
                      disabled={isLoading}
                      className="w-full inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 disabled:cursor-not-allowed transition-colors"
                    >
                      {isLoading ? 'Reviewing...' : 'Review Code'}
                    </button>
                  </div>
                </div>

                <div className="flex flex-col bg-slate-50 dark:bg-slate-900/70 rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700">
                  <h2 className="text-lg font-semibold text-slate-800 dark:text-white p-4 border-b border-slate-200 dark:border-slate-700 shrink-0">
                    Review Feedback
                  </h2>
                  <div className="flex-1 overflow-y-auto p-4">
                    <ReviewOutput review={review} isLoading={isLoading} error={error} />
                  </div>
                </div>
              </div>
            </>
          );
        }
        // --- END OF components/CodeReviewer.tsx ---

        // --- START OF components/ImageGenerator.tsx ---
        const ImageGeneratorSpinner = () => (
            <div className="flex flex-col items-center justify-center h-full text-center">
                <svg className="animate-spin -ml-1 mr-3 h-10 w-10 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p className="mt-4 text-slate-500 dark:text-slate-400">Gemini is creating your image...</p>
            </div>
        );

        const ImageGenerator = () => {
            const [prompt, setPrompt] = useState('A photorealistic image of a cat wearing a spacesuit, high resolution');
            const [imageUrl, setImageUrl] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');

            const handleGenerate = useCallback(async () => {
                if (!prompt.trim()) {
                setError('Please enter a prompt to generate an image.');
                return;
                }
                setIsLoading(true);
                setError('');
                setImageUrl('');
                try {
                const result = await generateImage(prompt);
                setImageUrl(result);
                } catch (err) {
                if (err instanceof Error) {
                    setError(`Failed to generate image: ${err.message}`);
                } else {
                    setError('An unknown error occurred during image generation.');
                }
                console.error(err);
                } finally {
                setIsLoading(false);
                }
            }, [prompt]);

            return (
                <>
                <header className="mb-6">
                    <h1 className="text-3xl font-bold text-slate-900 dark:text-white">AI Image Generator</h1>
                    <p className="text-slate-500 dark:text-slate-400 mt-1">Create stunning visuals with Gemini's image generation model.</p>
                </header>
                <div className="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-8 overflow-hidden">
                    <div className="flex flex-col h-full">
                        <div className="flex-1 flex flex-col">
                        <label htmlFor="prompt-input" className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            Your Prompt
                        </label>
                        <textarea
                            id="prompt-input"
                            value={prompt}
                            onChange={(e) => setPrompt(e.target.value)}
                            placeholder="e.g., A photorealistic image of a cat wearing a spacesuit on Mars"
                            className="flex-1 w-full p-3 font-sans text-sm bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-md resize-none focus:ring-indigo-500 focus:border-indigo-500"
                            rows={5}
                        />
                        </div>
                        <div className="mt-4">
                        <button
                            onClick={handleGenerate}
                            disabled={isLoading}
                            className="w-full inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 disabled:cursor-not-allowed transition-colors"
                        >
                            {isLoading ? 'Generating...' : 'Generate Image'}
                        </button>
                        </div>
                    </div>

                    <div className="flex flex-col items-center justify-center bg-slate-50 dark:bg-slate-900/70 rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700 p-4">
                    {isLoading && <ImageGeneratorSpinner />}
                    {error && (
                        <div className="text-center text-red-500">
                            <div className="bg-red-100 dark:bg-red-900/50 border border-red-400 dark:border-red-600 rounded-md p-4">
                            <p className="font-semibold">An Error Occurred</p>
                            <p className="text-sm">{error}</p>
                            </div>
                        </div>
                    )}
                    {!isLoading && !error && imageUrl && (
                        <img src={imageUrl} alt={prompt} className="max-w-full max-h-full object-contain rounded-md" />
                    )}
                    {!isLoading && !error && !imageUrl && (
                        <div className="text-center text-slate-500 dark:text-slate-400">
                            <p>Your generated image will appear here.</p>
                        </div>
                    )}
                    </div>
                </div>
                </>
            );
        }
        // --- END OF components/ImageGenerator.tsx ---
        
        // --- START OF components/ImageCompressor.tsx ---
        const ImageCompressor = () => {
            const formatBytes = (bytes, decimals = 2) => {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const dm = decimals < 0 ? 0 : decimals;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
            };

            const [originalImage, setOriginalImage] = useState(null);
            const [originalImageUrl, setOriginalImageUrl] = useState('');
            const [compressedImageUrl, setCompressedImageUrl] = useState('');
            const [quality, setQuality] = useState(75);
            const [originalSize, setOriginalSize] = useState(0);
            const [compressedSize, setCompressedSize] = useState(0);
            const [error, setError] = useState('');
            const fileInputRef = useRef(null);

            useEffect(() => {
                return () => {
                    if (originalImageUrl) URL.revokeObjectURL(originalImageUrl);
                    if (compressedImageUrl) URL.revokeObjectURL(compressedImageUrl);
                };
            }, [originalImageUrl, compressedImageUrl]);

            const handleImageChange = (file) => {
                if (!file.type.startsWith('image/')) {
                    setError('Please select a valid image file.');
                    return;
                }
                setError('');
                setOriginalImage(file);
                setOriginalSize(file.size);
                
                setOriginalImageUrl(URL.createObjectURL(file));
                
                setCompressedImageUrl('');
                setCompressedSize(0);
            };

            const handleFileSelect = (e) => {
                if (e.target.files && e.target.files[0]) {
                    handleImageChange(e.target.files[0]);
                }
            };
            
            const handleDrop = (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    handleImageChange(e.dataTransfer.files[0]);
                }
            };

            const handleCompress = useCallback(() => {
                if (!originalImageUrl) return;

                const img = new Image();
                img.src = originalImageUrl;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    if (!ctx) {
                        setError('Could not get canvas context for compression.');
                        return;
                    }
                    ctx.drawImage(img, 0, 0);

                    canvas.toBlob((blob) => {
                        if (blob) {
                            if (compressedImageUrl) {
                                URL.revokeObjectURL(compressedImageUrl);
                            }
                            setCompressedImageUrl(URL.createObjectURL(blob));
                            setCompressedSize(blob.size);
                        }
                    }, 'image/jpeg', quality / 100);
                };
                img.onerror = () => {
                    setError('Failed to load image for compression. The file might be corrupt.');
                };
            }, [originalImageUrl, quality, compressedImageUrl]);
            
            const handleDownload = () => {
                if (!compressedImageUrl) return;
                const a = document.createElement('a');
                a.href = compressedImageUrl;
                a.download = `compressed-${originalImage?.name.replace(/\.[^/.]+$/, "")}.jpg`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };

            const handleReset = () => {
                setOriginalImage(null);
                setOriginalImageUrl('');
                setCompressedImageUrl('');
                setQuality(75);
                setOriginalSize(0);
                setCompressedSize(0);
                setError('');
                if(fileInputRef.current) fileInputRef.current.value = '';
            }

            return (
                <>
                    <header className="mb-6">
                        <h1 className="text-3xl font-bold text-slate-900 dark:text-white">Image Compressor</h1>
                        <p className="text-slate-500 dark:text-slate-400 mt-1">Reduce image file sizes without compromising quality.</p>
                    </header>
                    <div className="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div className="flex flex-col">
                            {!originalImage ? (
                                <div 
                                    className="flex-1 flex flex-col items-center justify-center border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-8 text-center cursor-pointer hover:border-indigo-500 transition-colors"
                                    onClick={() => fileInputRef.current?.click()}
                                    onDrop={handleDrop}
                                    onDragOver={(e) => e.preventDefault()}
                                >
                                    <input type="file" ref={fileInputRef} onChange={handleFileSelect} accept="image/*" className="hidden" />
                                    <svg className="w-16 h-16 text-slate-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 16a4 4 0 01-4-4V6a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7z"></path><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 16v4m0 0l-2-2m2 2l2-2"></path></svg>
                                    <p className="text-slate-500 dark:text-slate-400">Drag & Drop Image Here</p>
                                    <p className="text-sm text-slate-400 dark:text-slate-500">or Click to Browse</p>
                                    {error && <p className="text-red-500 mt-2">{error}</p>}
                                </div>
                            ) : (
                                <div className="flex flex-col">
                                    <div className="relative mb-4 flex items-center justify-center bg-slate-100 dark:bg-slate-900 rounded-lg p-2">
                                       <img src={originalImageUrl} alt="Original" className="max-w-full h-auto object-contain rounded-md" />
                                    </div>
                                    <div className="text-sm text-center mb-4">Original Size: <strong>{formatBytes(originalSize)}</strong></div>

                                    <div className="mb-4">
                                        <label htmlFor="quality" className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Quality: {quality}</label>
                                        <input type="range" id="quality" min="1" max="100" value={quality} onChange={(e) => setQuality(parseInt(e.target.value))} className="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer" />
                                    </div>
                                     <button onClick={handleCompress} className="w-full inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                                        Compress
                                    </button>
                                </div>
                            )}
                        </div>

                         <div className="flex flex-col bg-slate-50 dark:bg-slate-900/70 rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700">
                            <h2 className="text-lg font-semibold text-slate-800 dark:text-white p-4 border-b border-slate-200 dark:border-slate-700 shrink-0">
                                Result
                            </h2>
                            <div className="flex-1 flex flex-col items-center justify-center p-4">
                               {compressedImageUrl ? (
                                   <>
                                        <div className="relative mb-4 flex-1 flex items-center justify-center w-full">
                                            <img src={compressedImageUrl} alt="Compressed" className="max-w-full max-h-full object-contain rounded-md" />
                                        </div>
                                        <div className="text-center mb-4">
                                            <p>Compressed Size: <strong className="text-green-500">{formatBytes(compressedSize)}</strong></p>
                                            {originalSize > 0 && <p>Reduction: <strong className="text-green-500">{(((originalSize - compressedSize) / originalSize) * 100).toFixed(2)}%</strong></p>}
                                        </div>
                                        <div className="w-full flex gap-4">
                                            <button onClick={handleDownload} className="flex-1 inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                                                Download
                                            </button>
                                            <button onClick={handleReset} className="flex-1 inline-flex justify-center items-center px-6 py-3 border border-slate-300 dark:border-slate-600 text-base font-medium rounded-md shadow-sm text-slate-700 dark:text-slate-200 bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                                                Reset
                                            </button>
                                        </div>
                                   </>
                               ) : (
                                   <p className="text-slate-500 dark:text-slate-400 text-center">Your compressed image will appear here.</p>
                               )}
                            </div>
                        </div>
                    </div>
                </>
            );
        }
        // --- END OF components/ImageCompressor.tsx ---

        // --- START OF components/DocumentSummarizer.tsx ---
        const DocumentSummarizer = () => {
            const [text, setText] = useState('');
            const [summary, setSummary] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');

            const handleSummarize = useCallback(async () => {
                if (!text.trim()) {
                setError('Please enter some text to summarize.');
                return;
                }
                setIsLoading(true);
                setError('');
                setSummary('');
                try {
                const result = await summarizeText(text);
                setSummary(result);
                } catch (err) {
                if (err instanceof Error) {
                    setError(`Failed to get summary: ${err.message}`);
                } else {
                    setError('An unknown error occurred during summarization.');
                }
                console.error(err);
                } finally {
                setIsLoading(false);
                }
            }, [text]);

            return (
                <>
                <header className="mb-6">
                    <h1 className="text-3xl font-bold text-slate-900 dark:text-white">Document Summarizer</h1>
                    <p className="text-slate-500 dark:text-slate-400 mt-1">Get a concise summary of any text using Gemini.</p>
                </header>
                <div className="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-8 overflow-hidden">
                    <div className="flex flex-col h-full">
                    <div className="flex-1 flex flex-col">
                        <label htmlFor="text-input" className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                        Your Text
                        </label>
                        <textarea
                        id="text-input"
                        value={text}
                        onChange={(e) => setText(e.target.value)}
                        placeholder="Paste your document or text here..."
                        className="flex-1 w-full p-3 font-sans text-sm bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-md resize-none focus:ring-indigo-500 focus:border-indigo-500"
                        />
                    </div>
                    <div className="mt-4">
                        <button
                        onClick={handleSummarize}
                        disabled={isLoading}
                        className="w-full inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-400 disabled:cursor-not-allowed transition-colors"
                        >
                        {isLoading ? 'Summarizing...' : 'Summarize Text'}
                        </button>
                    </div>
                    </div>

                    <div className="flex flex-col bg-slate-50 dark:bg-slate-900/70 rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700">
                    <h2 className="text-lg font-semibold text-slate-800 dark:text-white p-4 border-b border-slate-200 dark:border-slate-700 shrink-0">
                        Summary
                    </h2>
                    <div className="flex-1 overflow-y-auto p-4">
                        <ReviewOutput review={summary} isLoading={isLoading} error={error} />
                    </div>
                    </div>
                </div>
                </>
            );
        }
        // --- END OF components/DocumentSummarizer.tsx ---

        // --- START OF components/UnitConverter.tsx ---
        const UnitConverter = () => {
            const conversions = {
                length: {
                    meter: 1,
                    kilometer: 1000,
                    centimeter: 0.01,
                    millimeter: 0.001,
                    mile: 1609.34,
                    yard: 0.9144,
                    foot: 0.3048,
                    inch: 0.0254,
                },
                mass: {
                    gram: 1,
                    kilogram: 1000,
                    milligram: 0.001,
                    pound: 453.592,
                    ounce: 28.3495,
                },
                temperature: {
                    celsius: (c) => c,
                    fahrenheit: (f) => (f - 32) * 5/9,
                    kelvin: (k) => k - 273.15,
                },
            };

            const tempOutputConversions = {
                celsius: (c) => c,
                fahrenheit: (c) => (c * 9/5) + 32,
                kelvin: (c) => c + 273.15,
            };

            const [category, setCategory] = useState('length');
            const [inputValue, setInputValue] = useState('1');
            const [fromUnit, setFromUnit] = useState('meter');
            const [toUnit, setToUnit] = useState('foot');

            const handleCategoryChange = (e) => {
                const newCategory = e.target.value;
                setCategory(newCategory);
                const units = Object.keys(conversions[newCategory]);
                setFromUnit(units[0]);
                setToUnit(units[1] || units[0]);
                setInputValue('1');
            };

            const outputValue = useMemo(() => {
                const inputNum = parseFloat(inputValue);
                if (isNaN(inputNum)) return '';

                if (category === 'temperature') {
                    const baseValue = conversions.temperature[fromUnit](inputNum);
                    const result = tempOutputConversions[toUnit](baseValue);
                    return result.toFixed(2);
                } else {
                    const categoryUnits = conversions[category];
                    const baseValue = inputNum * categoryUnits[fromUnit];
                    const result = baseValue / categoryUnits[toUnit];
                    return result.toFixed(5);
                }
            }, [inputValue, fromUnit, toUnit, category]);
            
            const units = Object.keys(conversions[category]);

            return (
                <>
                <header className="mb-6">
                    <h1 className="text-3xl font-bold text-slate-900 dark:text-white">Unit Converter</h1>
                    <p className="text-slate-500 dark:text-slate-400 mt-1">Quickly convert between different units.</p>
                </header>
                <div className="flex-1 flex items-center justify-center">
                    <div className="w-full max-w-lg p-8 space-y-6 bg-slate-50 dark:bg-slate-900/70 rounded-lg border border-slate-200 dark:border-slate-700">
                    <div>
                        <label htmlFor="category" className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Category</label>
                        <select id="category" value={category} onChange={handleCategoryChange} className="w-full bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500 capitalize">
                        {Object.keys(conversions).map(cat => <option key={cat} value={cat}>{cat}</option>)}
                        </select>
                    </div>

                    <div className="flex items-center gap-4">
                        <div className="flex-1">
                        <label htmlFor="fromUnit" className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">From</label>
                        <select id="fromUnit" value={fromUnit} onChange={e => setFromUnit(e.target.value)} className="w-full bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500 capitalize">
                            {units.map(unit => <option key={unit} value={unit}>{unit}</option>)}
                        </select>
                        </div>
                        <div className="flex-1">
                        <label htmlFor="toUnit" className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">To</label>
                        <select id="toUnit" value={toUnit} onChange={e => setToUnit(e.target.value)} className="w-full bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500 capitalize">
                            {units.map(unit => <option key={unit} value={unit}>{unit}</option>)}
                        </select>
                        </div>
                    </div>
                    
                    <div>
                        <label htmlFor="inputValue" className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Input</label>
                        <input type="number" id="inputValue" value={inputValue} onChange={e => setInputValue(e.target.value)} className="w-full p-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
                    </div>

                    <div>
                        <p className="text-lg font-medium text-slate-700 dark:text-slate-300">Result:</p>
                        <p className="text-3xl font-bold text-indigo-600 dark:text-indigo-400 break-all">{outputValue}</p>
                    </div>
                    </div>
                </div>
                </>
            );
        }
        // --- END OF components/UnitConverter.tsx ---
        
        // --- START OF components/JsonFormatter.tsx ---
        const JsonFormatter = () => {
            const [jsonInput, setJsonInput] = useState('');
            const [formattedJson, setFormattedJson] = useState('');
            const [error, setError] = useState('');

            const handleFormat = useCallback(() => {
                if (!jsonInput.trim()) {
                setError('Please enter some JSON to format.');
                setFormattedJson('');
                return;
                }
                try {
                const parsed = JSON.parse(jsonInput);
                const formatted = JSON.stringify(parsed, null, 2);
                setFormattedJson(formatted);
                setError('');
                } catch (e) {
                if (e instanceof Error) {
                    setError(`Invalid JSON: ${e.message}`);
                } else {
                    setError('An unknown error occurred while parsing JSON.');
                }
                setFormattedJson('');
                }
            }, [jsonInput]);

            return (
                <>
                <header className="mb-6">
                    <h1 className="text-3xl font-bold text-slate-900 dark:text-white">JSON Formatter</h1>
                    <p className="text-slate-500 dark:text-slate-400 mt-1">Paste your JSON data to validate and format it instantly.</p>
                </header>
                <div className="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-8 overflow-hidden">
                    <div className="flex flex-col h-full">
                    <div className="flex-1 flex flex-col">
                        <label htmlFor="json-input" className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                        Your JSON
                        </label>
                        <textarea
                        id="json-input"
                        value={jsonInput}
                        onChange={(e) => setJsonInput(e.target.value)}
                        placeholder='{ "key": "value", "nested": { "number": 123 } }'
                        className="flex-1 w-full p-3 font-mono text-sm bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-600 rounded-md resize-none focus:ring-indigo-500 focus:border-indigo-500"
                        spellCheck="false"
                        />
                    </div>
                    <div className="mt-4">
                        <button
                        onClick={handleFormat}
                        className="w-full inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors"
                        >
                        Format JSON
                        </button>
                    </div>
                    </div>

                    <div className="flex flex-col bg-slate-50 dark:bg-slate-900/70 rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700">
                    <h2 className="text-lg font-semibold text-slate-800 dark:text-white p-4 border-b border-slate-200 dark:border-slate-700 shrink-0">
                        Formatted Output
                    </h2>
                    <div className="flex-1 overflow-auto p-4">
                        {error && (
                        <div className="text-center text-red-500 bg-red-100 dark:bg-red-900/50 border border-red-400 dark:border-red-600 rounded-md p-4">
                            <p className="font-semibold">Error</p>
                            <p className="text-sm">{error}</p>
                        </div>
                        )}
                        {!error && formattedJson && (
                        <pre className="text-sm font-mono whitespace-pre-wrap break-all"><code>{formattedJson}</code></pre>
                        )}
                        {!error && !formattedJson && (
                        <p className="text-slate-500 dark:text-slate-400 text-center">Your formatted JSON will appear here.</p>
                        )}
                    </div>
                    </div>
                </div>
                </>
            );
        }
        // --- END OF components/JsonFormatter.tsx ---

        // --- START OF components/RegexTester.tsx ---
        const RegexTester = () => {
            const [pattern, setPattern] = useState('\\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}\\b');
            const [flags, setFlags] = useState({ g: true, i: true, m: false });
            const [testString, setTestString] = useState('Contact us at support@example.com or sales@example.org for more info.');
            
            const handleFlagChange = (flag) => {
                setFlags(prev => ({ ...prev, [flag]: !prev[flag] }));
            };

            const { matches, error } = useMemo(() => {
                if (!pattern) return { matches: [], error: null };
                try {
                const flagsString = Object.keys(flags).filter(f => flags[f]).join('');
                const regex = new RegExp(pattern, flagsString);
                const allMatches = Array.from(testString.matchAll(regex));
                return { matches: allMatches, error: null };
                } catch (e) {
                return { matches: [], error: e.message };
                }
            }, [pattern, flags, testString]);

            return (
                <>
                <header className="mb-6">
                    <h1 className="text-3xl font-bold text-slate-900 dark:text-white">Regex Tester</h1>
                    <p className="text-slate-500 dark:text-slate-400 mt-1">Test your regular expressions in real-time.</p>
                </header>
                <div className="flex-1 flex flex-col overflow-hidden gap-4">
                    <div className="flex gap-4">
                    <div className="flex-1">
                        <label htmlFor="pattern" className="text-sm font-medium text-slate-700 dark:text-slate-300">Regular Expression</label>
                        <input
                        id="pattern"
                        type="text"
                        value={pattern}
                        onChange={e => setPattern(e.target.value)}
                        className={`w-full p-2 mt-1 font-mono text-sm bg-slate-50 dark:bg-slate-700 border rounded-md focus:ring-indigo-500 focus:border-indigo-500 ${error ? 'border-red-500' : 'border-slate-300 dark:border-slate-600'}`}
                        />
                    </div>
                    <div className="flex items-end gap-4">
                        {Object.keys(flags).map(flag => (
                        <label key={flag} className="flex items-center gap-2 cursor-pointer">
                            <input
                            type="checkbox"
                            checked={flags[flag]}
                            onChange={() => handleFlagChange(flag)}
                            className="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                            />
                            <span className="font-mono text-sm">{flag}</span>
                        </label>
                        ))}
                    </div>
                    </div>
                    {error && <p className="text-red-500 text-sm">{error}</p>}
                    <div>
                    <label htmlFor="testString" className="text-sm font-medium text-slate-700 dark:text-slate-300">Test String</label>
                    <textarea
                        id="testString"
                        value={testString}
                        onChange={e => setTestString(e.target.value)}
                        className="w-full p-2 mt-1 font-mono text-sm bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md resize-y focus:ring-indigo-500 focus:border-indigo-500 h-32"
                    />
                    </div>
                    <div className="flex-1 flex flex-col bg-slate-50 dark:bg-slate-900/70 rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700">
                    <h2 className="text-lg font-semibold text-slate-800 dark:text-white p-4 border-b border-slate-200 dark:border-slate-700 shrink-0">
                        Matches ({matches.length})
                    </h2>
                    <div className="flex-1 overflow-y-auto p-4">
                        {matches.length > 0 ? (
                        <ul className="space-y-2">
                            {matches.map((match, i) => (
                            <li key={i} className="p-2 bg-slate-100 dark:bg-slate-800 rounded-md">
                                <span className="font-mono text-sm text-indigo-600 dark:text-indigo-400 bg-indigo-100 dark:bg-indigo-900/50 px-1 py-0.5 rounded">{match[0]}</span>
                                <span className="text-xs text-slate-500 ml-2">(index: {match.index})</span>
                            </li>
                            ))}
                        </ul>
                        ) : (
                        <p className="text-slate-500 dark:text-slate-400 text-center">No matches found.</p>
                        )}
                    </div>
                    </div>
                </div>
                </>
            );
        }
        // --- END OF components/RegexTester.tsx ---

        // --- START OF components/PasswordGenerator.tsx ---
        const PasswordGenerator = () => {
            const charset = {
                lowercase: 'abcdefghijklmnopqrstuvwxyz',
                uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
                numbers: '0123456789',
                symbols: '!@#$%^&*()_+~`|}{[]:;?><,./-=',
            };

            const [password, setPassword] = useState('');
            const [length, setLength] = useState(16);
            const [options, setOptions] = useState({
                uppercase: true,
                numbers: true,
                symbols: true,
            });
            const [copied, setCopied] = useState(false);

            const generatePassword = useCallback(() => {
                let availableChars = charset.lowercase;
                if (options.uppercase) availableChars += charset.uppercase;
                if (options.numbers) availableChars += charset.numbers;
                if (options.symbols) availableChars += charset.symbols;

                let newPassword = '';
                for (let i = 0; i < length; i++) {
                newPassword += availableChars[Math.floor(Math.random() * availableChars.length)];
                }
                setPassword(newPassword);
                setCopied(false);
            }, [length, options]);

            useEffect(() => {
                generatePassword();
            }, [length, options, generatePassword]);
            
            const handleOptionChange = (option) => {
                setOptions(prev => ({...prev, [option]: !prev[option]}));
            };

            const handleCopy = () => {
                navigator.clipboard.writeText(password);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };
            
            return (
                <>
                <header className="mb-6">
                    <h1 className="text-3xl font-bold text-slate-900 dark:text-white">Password Generator</h1>
                    <p className="text-slate-500 dark:text-slate-400 mt-1">Create strong, secure, and random passwords.</p>
                </header>
                <div className="flex-1 flex items-center justify-center">
                    <div className="w-full max-w-lg p-8 space-y-6 bg-slate-50 dark:bg-slate-900/70 rounded-lg border border-slate-200 dark:border-slate-700">
                    <div className="relative">
                        <input
                        type="text"
                        value={password}
                        readOnly
                        className="w-full p-4 font-mono text-lg bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md pr-24"
                        aria-label="Generated Password"
                        />
                        <button onClick={handleCopy} className="absolute inset-y-0 right-0 px-4 text-sm font-medium text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-200">
                        {copied ? 'Copied!' : 'Copy'}
                        </button>
                    </div>

                    <div className="space-y-4">
                        <div className="flex items-center justify-between">
                        <label htmlFor="length" className="font-medium">Password Length</label>
                        <span className="text-lg font-bold text-indigo-600 dark:text-indigo-400">{length}</span>
                        </div>
                        <input
                        id="length"
                        type="range"
                        min="8"
                        max="64"
                        value={length}
                        onChange={e => setLength(parseInt(e.target.value))}
                        className="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer"
                        />
                    </div>

                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <label className="flex items-center gap-2 p-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md cursor-pointer">
                        <input type="checkbox" checked={options.uppercase} onChange={() => handleOptionChange('uppercase')} className="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"/>
                        <span>Uppercase</span>
                        </label>
                        <label className="flex items-center gap-2 p-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md cursor-pointer">
                        <input type="checkbox" checked={options.numbers} onChange={() => handleOptionChange('numbers')} className="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"/>
                        <span>Numbers</span>
                        </label>
                        <label className="flex items-center gap-2 p-3 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-md cursor-pointer">
                        <input type="checkbox" checked={options.symbols} onChange={() => handleOptionChange('symbols')} className="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"/>
                        <span>Symbols</span>
                        </label>
                    </div>
                    
                    <button
                        onClick={generatePassword}
                        className="w-full inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors"
                        >
                        Generate New Password
                        </button>
                    </div>
                </div>
                </>
            );
        }
        // --- END OF components/PasswordGenerator.tsx ---

        // --- START OF components/Sidebar.tsx ---
        const Sidebar = ({ isDarkMode, setIsDarkMode, activeTool, onNavClick, apiKey, onApiKeySave }) => {
            const navItems = [
                { name: 'Code Reviewer', icon: CodeIcon },
                { name: 'Image Generator', icon: DocumentIcon },
                { name: 'Image Compressor', icon: CompressIcon },
                { name: 'Document Summarizer', icon: DocumentIcon },
                { name: 'Unit Converter', icon: CalculatorIcon },
                { name: 'JSON Formatter', icon: TextIcon },
                { name: 'Regex Tester', icon: DeveloperIcon },
                { name: 'Password Generator', icon: ToolsIcon },
            ];
            
            const [localApiKey, setLocalApiKey] = useState(apiKey);
            const [showSaved, setShowSaved] = useState(false);

            useEffect(() => {
                setLocalApiKey(apiKey);
            }, [apiKey]);
            
            const handleSaveClick = () => {
                onApiKeySave(localApiKey);
                setShowSaved(true);
                setTimeout(() => setShowSaved(false), 2000);
            };

            return (
                <aside className="w-64 bg-white dark:bg-slate-800 rounded-2xl shadow-lg flex flex-col p-4 h-full">
                <div className="flex items-center gap-2 p-4 border-b border-slate-200 dark:border-slate-700">
                    <LogoIcon className="w-8 h-8 text-indigo-600" />
                    <h1 className="text-xl font-bold text-slate-800 dark:text-white">OmniTools</h1>
                </div>
                <nav className="flex-1 mt-4 overflow-y-auto">
                    <ul>
                    {navItems.map((item) => {
                        const isActive = item.name === activeTool;
                        return (
                        <li key={item.name}>
                            <button 
                            onClick={() => onNavClick(item.name)} 
                            className={`flex items-center gap-3 px-4 py-2 my-1 rounded-lg transition-colors w-full text-left ${
                                isActive 
                                ? 'bg-indigo-100 dark:bg-indigo-500/20 text-indigo-700 dark:text-indigo-300' 
                                : 'text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700'
                            }`}
                            aria-current={isActive ? 'page' : undefined}
                            >
                            <item.icon className="w-5 h-5" />
                            <span className="font-medium text-sm">{item.name}</span>
                            {isActive && <div className="w-1 h-4 bg-indigo-500 rounded-full ml-auto"></div>}
                            </button>
                        </li>
                        )}
                    )}
                    </ul>
                </nav>
                <div className="mt-auto p-4 border-t border-slate-200 dark:border-slate-700 space-y-4">
                    <div>
                    <label htmlFor="api-key" className="block text-sm font-medium text-slate-600 dark:text-slate-400 mb-1">
                        Gemini API Key
                    </label>
                    <div className="flex gap-2">
                        <input 
                        id="api-key"
                        type="password"
                        value={localApiKey}
                        onChange={(e) => setLocalApiKey(e.target.value)}
                        placeholder="Enter your API key"
                        className="flex-1 w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm p-1.5 text-xs focus:ring-indigo-500 focus:border-indigo-500"
                        />
                        <button
                        onClick={handleSaveClick}
                        className="px-3 py-1 text-xs font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                        >
                        {showSaved ? 'Saved!' : 'Save'}
                        </button>
                    </div>
                    </div>
                    <div className="flex items-center justify-between">
                    <span className="text-sm font-medium text-slate-600 dark:text-slate-400">Dark Mode</span>
                    <button onClick={() => setIsDarkMode(!isDarkMode)} aria-pressed={isDarkMode} className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${
                        isDarkMode ? 'bg-indigo-600' : 'bg-gray-200'
                    }`}>
                        <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
                        isDarkMode ? 'translate-x-6' : 'translate-x-1'
                        }`} />
                    </button>
                    </div>
                </div>
                </aside>
            );
        };
        // --- END OF components/Sidebar.tsx ---
        
        // --- START OF App.tsx ---
        const App = () => {
            const POPUP_AD_TRIGGER_COUNT = 3;
            const AI_TOOLS = ['Code Reviewer', 'Image Generator', 'Document Summarizer'];
            const DEFAULT_API_KEY = "AIzaSyA-m-Ka093qVIYzwP7Haj3_TA0IcRiD-jc";

            const [isDarkMode, setIsDarkMode] = useState(false);
            const [activeTool, setActiveTool] = useState('Code Reviewer');
            const [isPopupVisible, setPopupVisible] = useState(false);
            const [navigationCount, setNavigationCount] = useState(0);
            const [apiKey, setApiKey] = useState('');

            // Helper functions for safe localStorage access
            const safeLocalStorageGet = (key, fallback) => {
                try {
                    const item = localStorage.getItem(key);
                    return item === null ? fallback : item;
                } catch (e) {
                    console.warn(`Could not read from localStorage: ${key}`, e);
                    return fallback;
                }
            };

            const safeLocalStorageSet = (key, value) => {
                try {
                    localStorage.setItem(key, value);
                } catch (e) {
                    console.warn(`Could not write to localStorage: ${key}`, e);
                }
            };

            useEffect(() => {
                const storedKey = safeLocalStorageGet('gemini-api-key', null);
                if (storedKey) {
                    setApiKey(storedKey);
                } else {
                    setApiKey(DEFAULT_API_KEY);
                    safeLocalStorageSet('gemini-api-key', DEFAULT_API_KEY);
                }
                
                const storedDarkMode = safeLocalStorageGet('dark-mode', 'false') === 'true';
                setIsDarkMode(storedDarkMode);

            }, []);

            useEffect(() => {
                if (apiKey) {
                    initializeGemini(apiKey);
                }
            }, [apiKey]);
            
            useEffect(() => {
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                safeLocalStorageSet('dark-mode', isDarkMode);
            }, [isDarkMode]);

            const handleApiKeySave = (newKey) => {
                setApiKey(newKey);
                safeLocalStorageSet('gemini-api-key', newKey);
            };

            const handleNavClick = useCallback((toolName) => {
                setActiveTool(toolName);
                const newNavCount = navigationCount + 1;
                setNavigationCount(newNavCount);

                if (newNavCount >= POPUP_AD_TRIGGER_COUNT) {
                setPopupVisible(true);
                setNavigationCount(0);
                }
            }, [navigationCount]);

            const handleClosePopup = () => {
                setPopupVisible(false);
            };

            const renderTool = () => {
                if (AI_TOOLS.includes(activeTool) && !apiKey) {
                return <ApiKeyPrompt />;
                }

                switch (activeTool) {
                case 'Code Reviewer':
                    return <CodeReviewer />;
                case 'Image Generator':
                    return <ImageGenerator />;
                case 'Image Compressor':
                    return <ImageCompressor />;
                case 'Document Summarizer':
                    return <DocumentSummarizer />;
                case 'Unit Converter':
                    return <UnitConverter />;
                case 'JSON Formatter':
                    return <JsonFormatter />;
                case 'Regex Tester':
                    return <RegexTester />;
                case 'Password Generator':
                    return <PasswordGenerator />;
                default:
                    return <CodeReviewer />;
                }
            };

            return (
                <div className={`flex h-screen bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-200 font-sans transition-colors duration-300 ${isDarkMode ? 'dark' : ''}`}>
                <div className="p-4">
                    <Sidebar 
                    isDarkMode={isDarkMode} 
                    setIsDarkMode={setIsDarkMode} 
                    activeTool={activeTool} 
                    onNavClick={handleNavClick}
                    apiKey={apiKey}
                    onApiKeySave={handleApiKeySave}
                    />
                </div>
                <main className="flex-1 flex flex-col p-8 overflow-hidden">
                    <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-lg flex-1 flex flex-col overflow-hidden">
                    <BannerAd slotId={adsConfig.topBanner} />
                    <div className="flex-1 p-8 overflow-y-auto flex flex-col">
                        {renderTool()}
                    </div>
                    <BannerAd slotId={adsConfig.bottomBanner} />
                    </div>
                </main>
                <PopupAd 
                    slotId={adsConfig.popup} 
                    isOpen={isPopupVisible} 
                    onClose={handleClosePopup} 
                />
                </div>
            );
        }
        // --- END OF App.tsx ---

        // --- START OF index.tsx ---
        const rootElement = document.getElementById('root');
        if (!rootElement) {
          throw new Error("Could not find root element to mount to");
        }

        const root = ReactDOM.createRoot(rootElement);
        root.render(
          <React.StrictMode>
            <App />
          </React.StrictMode>
        );
        // --- END OF index.tsx ---
    </script>
</body>
</html>
